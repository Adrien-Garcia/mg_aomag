<?xml version="1.0"?>
<!--
/**
 * Addonline_SoColissimoLiberte
 * 
 * @category    Addonline
 * @package     Addonline_SoColissimoLiberte
 * @copyright   Copyright (c) 2011 Addonline
 * @author 	    Addonline (http://www.Addonline.fr)
 * @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */
-->
<config>
    <modules>
        <Addonline_SoColissimoLiberte>
            <version>1.0.4</version>
            <depends>
                <Owebia_Shipping2 />
                <Mage_Shipping />
            </depends>
        </Addonline_SoColissimoLiberte>
    </modules>
    
    <global>
    	<blocks>
            <socolissimoliberte><class>Addonline_SoColissimoLiberte_Block</class></socolissimoliberte>
        </blocks>
    	<models>
    		<socolissimoliberte>
    			<class>Addonline_SoColissimoLiberte_Model</class>
    			<resourceModel>socolissimoliberte_mysql4</resourceModel>
    		</socolissimoliberte>
    		<socolissimoliberte_mysql4>
    			<class>Addonline_SoColissimoLiberte_Model_Mysql4</class>
    			<entities>
    				<relais>
    					<table>socolissimoliberte_relais</table>
    				</relais>
    				<horairesOuverture>
    					<table>socolissimoliberte_horaire_ouverture</table>
    				</horairesOuverture>
    				<periodesFermeture>
    					<table>socolissimoliberte_periode_fermeture</table>
    				</periodesFermeture>
    			</entities>
    		</socolissimoliberte_mysql4>
    	</models>	
    	<events>
        	<admin_user_authenticate_after>
                <observers>
                    <Addonline_SoColissimoLiberte_Model_Observer>
	                    <type>singleton</type>
	            		<class>socolissimoliberte/observer</class>
	            		<method>_9cd4777ae76310fd6977a5c559c51820</method>
	          		</Addonline_SoColissimoLiberte_Model_Observer>
                </observers>
            </admin_user_authenticate_after>
        </events>
    	
    	<helpers>
            <socolissimoliberte>
                <class>Addonline_SoColissimoLiberte_Helper</class>
            </socolissimoliberte>
        </helpers>
    	<resources>
    		<socolissimoliberte_setup>
    			<setup>
    				<module>Addonline_SoColissimoLiberte</module>
    				 <class>Mage_Sales_Model_Mysql4_Setup</class>
    			</setup>
    			<connection>
    				<use>core_setup</use>
    			</connection>
    		</socolissimoliberte_setup>
    		
    		<socolissimoliberte_read>
				<connection>
                    <use>core_read</use>
                </connection>
    		</socolissimoliberte_read>
    		
    		<socolissimoliberte_write>
				<connection>
                    <use>core_write</use>
                </connection>
    		</socolissimoliberte_write>
    	</resources>
    	<translate>
            <modules>
                <Addonline_SoColissimoLiberte>
                    <files>
                        <shipping>Mage_Shipping.csv</shipping>
                        <owebia>Owebia_Shipping2.csv</owebia>
                        <default>Addonline_SoColissimoLiberte.csv</default>
                    </files>
                </Addonline_SoColissimoLiberte>
            </modules>
        </translate>
    </global>
    
    <frontend>
    	<layout>
            <updates>
                <socolissimoliberte module="Addonline_SoColissimoLiberte">
                    <file>socolissimoliberte.xml</file>
                </socolissimoliberte>
            </updates>
        </layout>
        
        <routers>
            <socolissimoliberte>
                <use>standard</use>
                <args>
                    <module>Addonline_SoColissimoLiberte</module>
                    <frontName>socolissimoliberte</frontName>
                </args>
            </socolissimoliberte>
        </routers>
        
        <translate>
            <modules>
                <Addonline_SoColissimoLiberte>
                    <files>
                        <default>Addonline_SoColissimoLiberte.csv</default>
                    </files>
                </Addonline_SoColissimoLiberte>
            </modules>
        </translate>
        
	    <events> 
	        <sales_quote_collect_totals_before>
                <observers>
                    <socolissimoliberte_observer>
                        <type>model</type>
                        <class>socolissimoliberte/observer</class>
                        <method>checkoutEventSocodata</method>
                    </socolissimoliberte_observer>
                </observers>
            </sales_quote_collect_totals_before>
            <checkout_type_onepage_save_order>
	            <observers>
	                <socolissimoliberte_observer>
	                    <type>singleton</type>
	            		<class>socolissimoliberte/observer</class>
	            		<method>addSocoAttributesToOrder</method>
	          		</socolissimoliberte_observer>
	        	</observers>
	        </checkout_type_onepage_save_order>
	        <checkout_onepage_controller_success_action>
	            <observers>
	                <socolissimoliberte_observer>
	                    <type>singleton</type>
	            		<class>socolissimoliberte/observer</class>
	            		<method>resetSession</method>
	          		</socolissimoliberte_observer>
	        	</observers>
	        </checkout_onepage_controller_success_action>
	    </events>
    </frontend>
    
    <default>
    	<carriers>
    		<socolissimoliberte>
    			<active>0</active>
    			<title>So Colissimo</title>
    			<model>Addonline_SoColissimoLiberte_Model_Carrier_ShippingMethod</model>    
				<config><![CDATA[
# So Colissimo (France, Monaco, Andorre)
{
	label: "So Colissimo",
	code: "socolissimo",
	destination: "FR,MC,AD",
	fees: "{table {cart.weight} in 0.5:5.55, 1.0:6.80, 2.0:7.75, 3.0:8.70, 5.0:10.60, 7.0:12.50, 10.0:15.35, 15.0:17.45, 30.0:23.75}",
}
]]></config>
				<tracking_view_url>http://www.coliposte.net/particulier/suivi_particulier.jsp?colispart={tracking_number}</tracking_view_url>
				<display_when_unavailable>0</display_when_unavailable>
				<stop_to_first_match>0</stop_to_first_match>
				<rdv_conditions>75001,75002,75003,75004,75005,75006,75007,75008,75009,75010,75011,75012,75013,75014,75015,75016,75116,75017,75018,75019,75020</rdv_conditions>
				<rdv_fees>4</rdv_fees>
				<remise_commercant>4</remise_commercant>
				<shipping_period>1</shipping_period>
				<rep_fichier_socolissimo>var/import/socolissimoliberte</rep_fichier_socolissimo>
				<sort_order>1</sort_order>
    		</socolissimoliberte>
    	</carriers>
    </default>
    <crontab>
        <jobs>
            <socolissimoliberte_import>
                <schedule><cron_expr>0 1 * * *</cron_expr></schedule>
                <run><model>socolissimoliberte/batch::run</model></run>
            </socolissimoliberte_import>
        </jobs>
    </crontab>
    
    <adminhtml>
    <acl>
        <resources>
            <all>
                <title>Allow Everything</title>
            </all>
            <admin>
                <children>
                    <system>
                        <children>
                            <config>
                                <children>
                                    <socolissimoliberte translate="title">
                                        <title>Addonline config</title>
                                        <sort_order>100</sort_order>
                                    </socolissimoliberte>
                                </children>
                            </config>
                        </children>
                    </system>
                </children>
            </admin>
        </resources>
    </acl>
	</adminhtml>
    
</config>
